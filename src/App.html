<script>
    import {
        hasLowerCase,
        hasSymbols,
        hasNumbers,
        hasUpperCase,
        length
    } from './store'
    
    import Password from './components/Password.html';
    
    const LETTERS = "zyxwvutsrqponmlkjihgfedcba"
    const NUMBERS = "9876543210"
    const SYMBOLS = "%*()?@#$~"
    
    let form, txtLength, chxLowerCase, chxUpperCase, chxSymbols, chxNumbers
    let psw_hystory = []

    let onClickReload = () => {
        psw && (psw_hystory = [psw, ...psw_hystory.slice(0, 9)])
        psw = generatePassword()
    }
    
    let onSubmitForm = () => {
        psw = generatePassword()
    }

    function generatePassword() {
        let psw = ''
        let alphabet = ''

        if ($hasLowerCase) alphabet += LETTERS
        if ($hasUpperCase) alphabet += LETTERS.toUpperCase()
        if ($hasSymbols) alphabet += SYMBOLS
        if ($hasNumbers) alphabet += NUMBERS

        if (alphabet.length) for (let i = 0; i < $length; i++) {
            psw += alphabet[Math.round(Math.random() * (alphabet.length - 1))]
        }

        return psw
    }
    
    export let psw = generatePassword()
</script>

<div class="o-grid">
    <div class="o-grid__cell u-width-1-2 u-width-1-1@tablet-portrait">

        <section>
            <Password value={psw}/>
            <a href="#generate-password" class="c-button-icon u-margin-left" on:click|preventDefault={onClickReload}>
                <i class="iconic" data-glyph="reload"></i>
            </a>
            <br>
            {#if psw_hystory.length > 0}
                <ul>
                {#each psw_hystory as psw_hystory_item}
                    <li>{psw_hystory_item}</li>
                {/each}
                </ul>
            {/if}
        </section>

    </div>
    <div class="o-grid__cell u-width-1-2 u-width-1-1@tablet-portrait">

        <section class="c-panel">
            <div class="c-panel__head">
                <h3>Настройки генератора пароля</h3>
            </div>
            <div class="c-panel__body">
                <form bind:this={form} on:change={onSubmitForm} class="o-form js-psw-options">
                    <label class="o-form__row c-field-box">
                        <span class="c-field-label">Длинна пароля: {$length}</span>
                        <input bind:this={txtLength} bind:value={$length} type="range" name="length" min="3" max="24" class="c-field">
                    </label>
                    <label class="o-form__row">
                        <input bind:this={chxNumbers} bind:checked={$hasNumbers} type="checkbox" name="numbers" class="c-field">
                        <span class="c-field-label">Цифры</span>
                    </label>
                    <label class="o-form__row">
                        <input bind:this={chxUpperCase} bind:checked={$hasUpperCase} type="checkbox" name="upper-case" class="c-field">
                        <span class="c-field-label">Прописные буквы</span>
                    </label>
                    <label class="o-form__row">
                        <input bind:this={chxLowerCase} bind:checked={$hasLowerCase} type="checkbox" name="lower-case" class="c-field">
                        <span class="c-field-label">Строчные буквы</span>
                    </label>
                    <label class="o-form__row">
                        <input bind:this={chxSymbols} bind:checked={$hasSymbols} type="checkbox" name="symbols" class="c-field">
                        <span class="c-field-label">Символы <q>{SYMBOLS}</q></span>
                    </label>
                </form>
            </div>
        </section>
		
    </div>
</div>

<style>
    .o-form__row {
        justify-content: flex-start;
    }
</style>